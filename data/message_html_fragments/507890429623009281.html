<div class="chatlog__message-group">
  <div id="chatlog__message-container-507890429623009281" class="chatlog__message-container " data-message-id="507890429623009281">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <img class="chatlog__avatar" src="https://cdn.discordapp.com/avatars/431048656884334606/12404c3148cdca1fed20bebbbc820a81.png?size=512" alt="Avatar" loading="lazy">
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__header">
          <span class="chatlog__author" style="color: rgb(241, 196, 15)" title="acevif#0050" data-user-id="431048656884334606">acevif</span>
          <span class="chatlog__timestamp">02-Nov-18 12:15 PM</span>
        </div>
        <div class="chatlog__content chatlog__markdown">
          <span class="chatlog__markdown-preserve"><span class="chatlog__markdown-mention" title="omochimetaru#1122">@omochimetaru</span> テスト対象の実装はテストケースでは変化させていません。StubAnimalはSUTをテストするための外部環境として使っています @t.ae#5802 さんのアドバイスをうけてTest module内にextensionでデフォルト実装を定義し、Stubではそのテストで関心がある間接入力だけを定義する方法で書き直してみたところ、以前よりかなり見通しのいいテストになりました 以前のStubはStubと名乗りながら、間接出力をチェックしたり間接出力のタイミングに依存して間接入力を返したり、Dummyとしても振る舞えるようにしていて、それが根本的な問題だったように思います。 書き直したタイミングでStubは間接入力にほぼ専念するようにしたので、かなり綺麗になりました。</span>
        </div>
      </div>
    </div>
  </div>
</div>