<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/189711109966659584/95280765d1be73ce985dce15ea3585f6.png?size=128" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="omochimetaru#1122" data-user-id="189711109966659584" style="color: rgb(237,171,161)">omochimetaru</span>
    <span class="chatlog__timestamp">08-Oct-19 02:08 AM</span>
    <div class="chatlog__message " data-message-id="630949678934130688" id="message-630949678934130688" title="Message sent: 08-Oct-19 02:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">１つ目のコードについては</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630949769103278100" id="message-630949769103278100" title="Message sent: 08-Oct-19 02:09 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">concurrentキューなので</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630949847847010304" id="message-630949847847010304" title="Message sent: 08-Oct-19 02:09 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">投入されるタスク同士は並行に動いちゃいます</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950077455663104" id="message-630950077455663104" title="Message sent: 08-Oct-19 02:10 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">Dictionaryに対する並行アクセスが、readだけでも並行アクセスしても大丈夫なのかがそもそもわからないので、get側のsyncだけでも怪しい気はしますが、それは別にしても</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950236285829120" id="message-630950236285829120" title="Message sent: 08-Oct-19 02:10 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">set側のasync(barrier)は、バリアされたタスク同士の同時実行を防ぐものなので <a href="https://developer.apple.com/documentation/dispatch/dispatchworkitemflags/1780674-barrier">https://developer.apple.com/documentation/dispatch/dispatchworkitemflags/1780674-barrier</a></span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950301624434728" id="message-630950301624434728" title="Message sent: 08-Oct-19 02:11 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>書き込み操作同士は直列化されますが</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:34 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950413868335104" id="message-630950413868335104" title="Message sent: 08-Oct-19 02:11 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>読み込み操作とは（多分）排他されないので</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:34 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950468071325707" id="message-630950468071325707" title="Message sent: 08-Oct-19 02:11 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>Dictionaryに対して書き込みと読み込みを同時に行う可能性のあるコードになってます</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:34 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950559066882068" id="message-630950559066882068" title="Message sent: 08-Oct-19 02:12 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>これは明確にDictionaryに対する違反なので暴走して未定義状態になってると思います。</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:35 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950641971494928" id="message-630950641971494928" title="Message sent: 08-Oct-19 02:12 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">２つ目のコードについては、デッドロックしてないと思います。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950710346907659" id="message-630950710346907659" title="Message sent: 08-Oct-19 02:12 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>nを10000x1から10000x10まで順番に増加させていくと</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:35 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950777963151370" id="message-630950777963151370" title="Message sent: 08-Oct-19 02:13 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>だんだん処理時間が増加していって、6,7,8ぐらいで急激に増加してました</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:35 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630950841771229204" id="message-630950841771229204" title="Message sent: 08-Oct-19 02:13 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>なので、x10のときも時間がかかってるだけに思います。</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:35 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951037259218974" id="message-630951037259218974" title="Message sent: 08-Oct-19 02:14 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>急激に増加するのはおそらくDictionaryのrehashが発生するからだと思います。</s></span>
          <span class="chatlog__edited-timestamp" title="08-Oct-19 02:35 AM">(edited)</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951165697458187" id="message-630951165697458187" title="Message sent: 08-Oct-19 02:14 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ちなみに1つ目のコードに関しても、 個人的には書き込みをasyncで後回しにするのはあまりやらないほうが良いと思っていて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951310857863168" id="message-630951310857863168" title="Message sent: 08-Oct-19 02:15 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">その理由は、後回しにする事自体がDispatchQueue側のリソースを食うからです。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951412880244736" id="message-630951412880244736" title="Message sent: 08-Oct-19 02:15 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">めちゃくちゃたくさん使われるプリミティブなところでそういう処理を書くと、ちょっとしたスケジューリングのブレとかで、</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951474670731265" id="message-630951474670731265" title="Message sent: 08-Oct-19 02:15 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">一瞬で10000タスクがDispatchQueueに乗って待機しちゃうことがありえます</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="630951551711838228" id="message-630951551711838228" title="Message sent: 08-Oct-19 02:16 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">そうすると普通にそれだけの要素数の配列を読み書きするコストがDispatchQueue内部でかかるし、メモリも食うので、</span>
        </div>
      </div>
    </div>
  </div>
</div>