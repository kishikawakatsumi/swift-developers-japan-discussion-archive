<div class="chatlog__message-group">
  <div id="chatlog__message-container-821347439117074453" class="chatlog__message-container" data-message-id="821347439117074453">
    <div class="chatlog__message">
      <div class="chatlog__message-aside"><img class="chatlog__avatar" src="https://cdn.discordapp.com/avatars/293572563010060288/92f572b5e1ef6656a55498787c15a5ad.png?size=512" alt="Avatar" loading="lazy"></div>
      <div class="chatlog__message-primary">
        <div class="chatlog__header"><span class="chatlog__author" style="color:rgb(231,76,60)" title="tarunon#9603" data-user-id="293572563010060288">tarunon</span> <a href="/channels/306995750418513920?category=main&amp;channel=swift-2&amp;message_id=821352527324905473"><span class="chatlog__timestamp"></span></a><a href="#chatlog__message-container-821347439117074453">16-Mar-21 11:41 AM</a></div>
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve"><a href="https://discord.com/channels/291054398077927425/430242233468452865/821280456557199370" onclick="scrollToMessage(event, '821280456557199370')">https://discord.com/channels/291054398077927425/430242233468452865/821280456557199370</a> のOptionalの話の詳細 <span class="chatlog__markdown-mention" title="Iceman#5499">@Iceman</span> FYI</span></div>
        <div class="chatlog__reactions">
          <div class="chatlog__reaction" title="eyes"><img class="chatlog__emoji chatlog__emoji--small" alt="👀" src="https://twemoji.maxcdn.com/2/svg/1f440.svg" loading="lazy"> <span class="chatlog__reaction-count">1</span></div>
        </div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821347579044429826" class="chatlog__message-container" data-message-id="821347579044429826">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:42 AM">11:42</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">議論がとっ散らかるとよくないのでサブタイプが存在することによって発生する大きな問題点を2つ、整理します。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821348331073699841" class="chatlog__message-container" data-message-id="821348331073699841">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:45 AM">11:45</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">まず1つ目がサブタイプであるにも関わらず、実体が異なってしまうという点 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">var s = 1 var a: Int = s var b: Int? = s</code> のaとbが異なるということですね。クラスサブクラス、あるいはExistentialと具体型の関係なら、これは同じものを指すわけです。(Existentialは厳密には異なるが省略) <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">var s = Cat() var a: Animal = s var b: Cat = s</code> この結果発生する問題として、 実態が異なっているということを知っているユーザーと知らないユーザーとの間で、期待する挙動に差が出てきます。例えば</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821348647374684171" class="chatlog__message-container" data-message-id="821348647374684171">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:46 AM">11:46</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve"><a href="https://discord.com/channels/291054398077927425/375206337937801216/806433474579005440" onclick="scrollToMessage(event, '806433474579005440')">https://discord.com/channels/291054398077927425/375206337937801216/806433474579005440</a> 最近発生したバグとされるこの挙動。 AnyHashableにInt?の値を入れた時に、Intを入れた時と異なってしまう、というバグ</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821348808893267989" class="chatlog__message-container" data-message-id="821348808893267989">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:46 AM">11:46</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">でもこれは、「いやいやそうは言っても <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">.some(1)</code> と <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">1</code> は別でしょ」っていう理解のユーザーからは、AnyHashableの値が異なることこそが期待される挙動なはずです。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821349096941158400" class="chatlog__message-container" data-message-id="821349096941158400">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:48 AM">11:48</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">このOptionalであるか否かが同一かどうかというのは、文脈によっても期待される挙動が異なるので、ケースバイケースでコンパイラの挙動が変わることが期待されてしまう。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821349150502682675" class="chatlog__message-container" data-message-id="821349150502682675">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:48 AM">11:48</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">片方を立てれば片方は立たなくなる、という問題の根源になりえるわけです。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821349222254772245" class="chatlog__message-container" data-message-id="821349222254772245">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:48 AM">11:48</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">次 2つ目、サブタイプのルールづけに優先順位が必要という話。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821350073941229600" class="chatlog__message-container" data-message-id="821350073941229600">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:51 AM">11:51</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">これは結構私は方々でぶーを垂れてるので知ってるかもですが、 TがT?のサブタイプである UがTのサブタイプであるならばU?はT?のサブタイプである この2点がSwiftでは許可されています。で、下のコードはコンパイルが通る。 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">var s = Cat() var a: Animal = s // CatとAnimalのサブタイプ関係が成り立つことを示す var b: Cat? = s var c: Animal? = b</code> U?はT?のサブタイプ、は具体のコードとしては、 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">UITableViewController?</code> な変数が <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">UIViewController?</code> に渡せる、というのが頻出すると思います。</span> <span class="chatlog__edited-timestamp" title="16-Mar-21 12:25 PM">(edited)</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821350287096545332" class="chatlog__message-container" data-message-id="821350287096545332">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:52 AM">11:52</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">もちろんOptionalは実体は別なので、暗黙的な変換が挟まるわけですが、どうなっているかというと</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821350462551752704" class="chatlog__message-container" data-message-id="821350462551752704">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:53 AM">11:53</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve"><code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">var s = Cat() var a: Animal = s // CatとAnimalのサブタイプ関係が成り立つことを示す var b: Cat? = .some(s) var c: Animal? = b.map { $0 as Animal }</code> mapのところは本当は違うと思うんですが、まあ雑にこんな感じ。</span> <span class="chatlog__edited-timestamp" title="16-Mar-21 11:53 AM">(edited)</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821350630307790900" class="chatlog__message-container" data-message-id="821350630307790900">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:54 AM">11:54</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">じゃあここに一行付け加えて、これはどうあるべきでしょうか。というのが問題になります。 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">var d: Cat?? = b // b: Cat?</code></span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821350888341504030" class="chatlog__message-container" data-message-id="821350888341504030">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:55 AM">11:55</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">解釈としては2通りあって、 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">1. オプショナルのサブタイプなので.someでラップする 2. CatはCat?のサブタイプなのだから、.mapでOK</code></span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821351511627268127" class="chatlog__message-container" data-message-id="821351511627268127">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:57 AM">11:57</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">今このコードだと、Cat?は.someなので結果は同じなんですが、Cat?が.noneだと、1,2のどちらを採用するかで結果が変わります。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821351845002870846" class="chatlog__message-container" data-message-id="821351845002870846">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:58 AM">11:58</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve"><code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">// 1. var d1 = .some(b) // 見たまま.some(.none)になります // 2. var d2 = b.map { $0 as Cat? } // これは.noneになります</code> じゃあこれがどういう問題を引き起こしたかというと</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821351910740983838" class="chatlog__message-container" data-message-id="821351910740983838">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 11:59 AM">11:59</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">過去のSwiftではコンテキストの差によって2.の変換が採用されていた時代がありました。</span></div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-821352527324905473" class="chatlog__message-container" data-message-id="821352527324905473">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="16-Mar-21 12:01 PM">12:01</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">あった、これかな <a href="https://bugs.swift.org/browse/SR-6126?filter=-2">https://bugs.swift.org/browse/SR-6126?filter=-2</a></span></div>
      </div>
    </div>
  </div>
</div>