<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/4.png" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="takasek#2409" data-user-id="295054334234722305" style="color: rgb(241,196,15)">takasek</span>
    <span class="chatlog__timestamp">26-Oct-17 02:24 PM</span>
    <div class="chatlog__message " data-message-id="373114548959444992" id="message-373114548959444992" title="Message sent: 26-Oct-17 02:24 PM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ボイラープレート消せる方向性探りたいですね</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="373115299953770496" id="message-373115299953770496" title="Message sent: 26-Oct-17 02:26 PM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">URLをStringとして持つ話、 - そこを型として明示したい - <span class="pre pre--inline">url.flatMap {URL(string: $0)}</span> を都度書きたくない と思ったけど、<img loading="lazy" class="emoji " alt="👇" title="point_down" src="https://twemoji.maxcdn.com/2/svg/1f447.svg">このアプローチどうですかね <div class="pre pre--multiline language-swift">/// デコードしたStringと、TypedなURLは纏めて独自型に押し込めるほうがいい struct RobustURL: Codable { let rawValue: String var typed: URL? { return URL(string: rawValue) } func encode(to encoder: Encoder) throws { var container = encoder.singleValueContainer() try container.encode(rawValue) } init(from decoder: Decoder) throws { rawValue = try decoder.singleValueContainer().decode(String.self) } } /// CoreGraphicに依存しない独自型 struct Size: Codable { let width: Double let height: Double } import CoreGraphics extension Size { var asCGSize: CGSize { return CGSize(width: width, height: height) } } struct Fuga: Codable { let url1: RobustURL // 不正なURLが来うることを型として示せる let url2: RobustURL // 不正なURLが来うることを型として示せる let url3: URL // 不正なURLが来ないことを型として示せる let size: Size } let data = """ { "url1": "https://failable.url", "url2": "不正なURL", "url3": "https://ensured.url", "size": { "width": 100, "height": 50 } } """.data(using: .utf8)! let fuga = try! JSONDecoder().decode(Fuga.self, from: data) fuga.url1.typed // https://failable.url fuga.url2.typed // nil fuga.url3 // https://ensured.url fuga.size.asCGSize // {w 100 h 50} let json = try! JSONEncoder().encode(fuga) print(String(data: json, encoding: .utf8)!) // {"size":{"width":100,"height":50},"url3":"https:\/\/ensured.url","url1":"https:\/\/failable.url","url2":"不正なURL"}</div></span>
        </div>
      </div>
    </div>
  </div>
</div>