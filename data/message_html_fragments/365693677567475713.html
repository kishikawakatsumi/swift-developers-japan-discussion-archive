<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/189711109966659584/95280765d1be73ce985dce15ea3585f6.png?size=128" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="omochimetaru#1122" data-user-id="189711109966659584" style="color: rgb(237,171,161)">omochimetaru</span>
    <span class="chatlog__timestamp">06-Oct-17 02:54 AM</span>
    <div class="chatlog__message " data-message-id="365693144970428417" id="message-365693144970428417" title="Message sent: 06-Oct-17 02:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><a href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L180-L185">https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L180-L185</a></span>
        </div>
      </div>
      <div class="chatlog__embed">
        <div class="chatlog__embed-color-pill chatlog__embed-color-pill--default"></div>
        <div class="chatlog__embed-content-container">
          <div class="chatlog__embed-content">
            <div class="chatlog__embed-text">
              <div class="chatlog__embed-title">
                <a class="chatlog__embed-title-link" href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift">
                  <div class="markdown preserve-whitespace">apple/swift</div>
                </a>
              </div>
              <div class="chatlog__embed-description">
                <div class="markdown preserve-whitespace">swift - The Swift Programming Language</div>
              </div>
            </div>
            <div class="chatlog__embed-thumbnail-container">
              <a class="chatlog__embed-thumbnail-link" href="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145">
                <img class="chatlog__embed-thumbnail" src="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145" alt="Thumbnail" loading="lazy">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693241590284299" id="message-365693241590284299" title="Message sent: 06-Oct-17 02:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">runtimeがObjC <strong>ではない</strong> 場合の、 Array の _Buffer がこのオブジェクトだけど</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693327309406210" id="message-365693327309406210" title="Message sent: 06-Oct-17 02:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">_EmptyArrayStorage って型もあって</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693342903828490" id="message-365693342903828490" title="Message sent: 06-Oct-17 02:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">そっちは</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693345068220416" id="message-365693345068220416" title="Message sent: 06-Oct-17 02:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><a href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L67">https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L67</a></span>
        </div>
      </div>
      <div class="chatlog__embed">
        <div class="chatlog__embed-color-pill chatlog__embed-color-pill--default"></div>
        <div class="chatlog__embed-content-container">
          <div class="chatlog__embed-content">
            <div class="chatlog__embed-text">
              <div class="chatlog__embed-title">
                <a class="chatlog__embed-title-link" href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift">
                  <div class="markdown preserve-whitespace">apple/swift</div>
                </a>
              </div>
              <div class="chatlog__embed-description">
                <div class="markdown preserve-whitespace">swift - The Swift Programming Language</div>
              </div>
            </div>
            <div class="chatlog__embed-thumbnail-container">
              <a class="chatlog__embed-thumbnail-link" href="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145">
                <img class="chatlog__embed-thumbnail" src="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145" alt="Thumbnail" loading="lazy">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693438110203904" id="message-365693438110203904" title="Message sent: 06-Oct-17 02:55 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">型パラがなくてstaticElementType がVoid.selfになってる</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693677567475713" id="message-365693677567475713" title="Message sent: 06-Oct-17 02:56 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">internal struct _ContiguousArrayBuffer&lt;Element&gt;は</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693731862478848" id="message-365693731862478848" title="Message sent: 06-Oct-17 02:56 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><a href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L318">https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L318</a></span>
        </div>
      </div>
      <div class="chatlog__embed">
        <div class="chatlog__embed-color-pill chatlog__embed-color-pill--default"></div>
        <div class="chatlog__embed-content-container">
          <div class="chatlog__embed-content">
            <div class="chatlog__embed-text">
              <div class="chatlog__embed-title">
                <a class="chatlog__embed-title-link" href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift">
                  <div class="markdown preserve-whitespace">apple/swift</div>
                </a>
              </div>
              <div class="chatlog__embed-description">
                <div class="markdown preserve-whitespace">swift - The Swift Programming Language</div>
              </div>
            </div>
            <div class="chatlog__embed-thumbnail-container">
              <a class="chatlog__embed-thumbnail-link" href="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145">
                <img class="chatlog__embed-thumbnail" src="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145" alt="Thumbnail" loading="lazy">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365693776305324033" id="message-365693776305324033" title="Message sent: 06-Oct-17 02:56 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">空で初期化するときは↑のEmptyArrayStorageを内部で使う</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365694004580450305" id="message-365694004580450305" title="Message sent: 06-Oct-17 02:57 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><a href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L204">https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift#L204</a></span>
        </div>
      </div>
      <div class="chatlog__embed">
        <div class="chatlog__embed-color-pill chatlog__embed-color-pill--default"></div>
        <div class="chatlog__embed-content-container">
          <div class="chatlog__embed-content">
            <div class="chatlog__embed-text">
              <div class="chatlog__embed-title">
                <a class="chatlog__embed-title-link" href="https://github.com/apple/swift/blob/master/stdlib/public/core/ContiguousArrayBuffer.swift">
                  <div class="markdown preserve-whitespace">apple/swift</div>
                </a>
              </div>
              <div class="chatlog__embed-description">
                <div class="markdown preserve-whitespace">swift - The Swift Programming Language</div>
              </div>
            </div>
            <div class="chatlog__embed-thumbnail-container">
              <a class="chatlog__embed-thumbnail-link" href="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145">
                <img class="chatlog__embed-thumbnail" src="https://images-ext-1.discordapp.net/external/VzNx6xvMLRaO_R4AWubaDUuAkRCdKRQHx7PEDv8dwuU/%3Fv%3D4%26s%3D400/https/avatars2.githubusercontent.com/u/10639145" alt="Thumbnail" loading="lazy">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365694121635217408" id="message-365694121635217408" title="Message sent: 06-Oct-17 02:57 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">要素数付きの未初期化(uninitialized memory) バッファを確保するinitは型月の_ContiguousArrayStorage&lt;Element&gt; を使う</span>
        </div>
      </div>
      <div class="chatlog__reactions">
        <div class="chatlog__reaction" title="last_quarter_moon_with_face">
          <img class="emoji emoji--small" alt="🌜" src="https://twemoji.maxcdn.com/2/svg/1f31c.svg" loading="lazy">
          <span class="chatlog__reaction-count">1</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365694509532708864" id="message-365694509532708864" title="Message sent: 06-Oct-17 02:59 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift">final class _EmptyArrayStorage : _ContiguousArrayStorageBase { } final class _ContiguousArrayStorage&lt;Element&gt; : _ContiguousArrayStorageBase { }</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365694652835430402" id="message-365694652835430402" title="Message sent: 06-Oct-17 02:59 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">↑共通の親クラスになってて struct _ContiguousArrayBuffer は、 _ContiguousArrayStorageBase を var _storageでもってる。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365695048056176641" id="message-365695048056176641" title="Message sent: 06-Oct-17 03:01 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">struct Array がAPI層で runtimeによってBufferの型を変える struct ArrayBuffer が 可変長バッファの制御をしてる実装の層 class ArrayStorage系 が実際の連続メモリを表現してるメモリの層で、空と型付きがあって、要素の型が取れる</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365695409886068738" id="message-365695409886068738" title="Message sent: 06-Oct-17 03:03 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">Arrayのinit() では _Buffer のinit() を呼んでるから _EmptyArrayStorage になってそう</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365695842457223169" id="message-365695842457223169" title="Message sent: 06-Oct-17 03:04 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">objc runtime の場合は、 ContiguousArrayBufferじゃなくて、 ArrayBufferが使われていて、 ArrayBufferは storage を持ってるので、 Array / Buffer / Storage の３層設計はおなじだけど</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365695874963210241" id="message-365695874963210241" title="Message sent: 06-Oct-17 03:04 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">internal typealias _ArrayBridgeStorage = _BridgeStorage&lt;_ContiguousArrayStorageBase, _NSArrayCore&gt; Storageの型がこれになっていて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696004428660746" id="message-365696004428660746" title="Message sent: 06-Oct-17 03:05 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">Storage の実装として BridgeStorage という概念が出てきて、 _NSArrayCore ・・・</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696114642386947" id="message-365696114642386947" title="Message sent: 06-Oct-17 03:05 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">心配になってきた</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696161291567104" id="message-365696161291567104" title="Message sent: 06-Oct-17 03:05 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ちゃんとboxingしないでInt並べてるのか・・・？</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696429286752266" id="message-365696429286752266" title="Message sent: 06-Oct-17 03:07 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift"> // rawValue is passed inout to _isUnique. Although its value // is unchanged, it must appear mutable to the optimizer. @_versioned internal var rawValue: Builtin.BridgeObject</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696543526879232" id="message-365696543526879232" title="Message sent: 06-Oct-17 03:07 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift"> @_inlineable // FIXME(sil-serialize-all) public // @testable var nativeInstance: Native { @inline(__always) get { _sanityCheck(isNative) return Builtin.castReferenceFromBridgeObject(rawValue) } }</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696717800210434" id="message-365696717800210434" title="Message sent: 06-Oct-17 03:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift"> var objCInstance: ObjC { @inline(__always) get { _sanityCheck(isObjC) return Builtin.castReferenceFromBridgeObject(rawValue) } }</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696758791012382" id="message-365696758791012382" title="Message sent: 06-Oct-17 03:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">NativeとObjCは BridgeStorageの型パラメータで、</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696786611961857" id="message-365696786611961857" title="Message sent: 06-Oct-17 03:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">rawValueってフィールドに</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696812826230784" id="message-365696812826230784" title="Message sent: 06-Oct-17 03:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">どっちかの型のオブジェクトがぶちこまれて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696843503501312" id="message-365696843503501312" title="Message sent: 06-Oct-17 03:08 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">分岐したりキャストしてなんかEitherっぽくなってる</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696970054041602" id="message-365696970054041602" title="Message sent: 06-Oct-17 03:09 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift">internal typealias _ArrayBridgeStorage = _BridgeStorage&lt;_ContiguousArrayStorageBase, _NSArrayCore&gt;</div> で、左側が さっきの pure swift のときの Storage の _ContiguousArrayStorageBase だから、
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365696995308077068" id="message-365696995308077068" title="Message sent: 06-Oct-17 03:09 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">大丈夫そうな気がする</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365697122667986945" id="message-365697122667986945" title="Message sent: 06-Oct-17 03:09 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ObjCから来たオブジェクトだとBridgeStorageのrawValueが右側の_NSArrayCoreになっていて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365697172144128001" id="message-365697172144128001" title="Message sent: 06-Oct-17 03:10 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">Swiftから来たオブジェクトだとrawvalueが左側のContiguousASBになっていると予想</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="365697249394688002" id="message-365697249394688002" title="Message sent: 06-Oct-17 03:10 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">あとはなんか <span class="pre pre--inline">as</span> とかでObjC側にブリッジしたりするときにめんどくさいことが起こるんだろう・・・</span>
        </div>
      </div>
    </div>
  </div>
</div>