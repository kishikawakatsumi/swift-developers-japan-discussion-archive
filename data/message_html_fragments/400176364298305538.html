<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/189711109966659584/95280765d1be73ce985dce15ea3585f6.png?size=128" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="omochimetaru#1122" data-user-id="189711109966659584" style="color: rgb(237,171,161)">omochimetaru</span>
    <span class="chatlog__timestamp">09-Jan-18 06:36 AM</span>
    <div class="chatlog__message " data-message-id="400175930640695296" id="message-400175930640695296" title="Message sent: 09-Jan-18 06:36 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">えっとまず</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400175943819198474" id="message-400175943819198474" title="Message sent: 09-Jan-18 06:36 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift">struct Cat { var age: Int = 3 var name: String = "mike" } var cats = [Cat.init(), Cat(), Cat()] let x = cats.flatMap { $0.age } print(x)</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176021925527552" id="message-400176021925527552" title="Message sent: 09-Jan-18 06:36 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline nohighlight">[3, 3, 3]</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176063000477697" id="message-400176063000477697" title="Message sent: 09-Jan-18 06:36 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">これがコンパイルが通っちゃうのが微妙だよね、という話があります</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176148371341313" id="message-400176148371341313" title="Message sent: 09-Jan-18 06:37 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">これは、プログラマーが意図していたコードは正しくは、 <span class="pre pre--inline">cats.map { $0.age }</span> です。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176248548229121" id="message-400176248548229121" title="Message sent: 09-Jan-18 06:37 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">String から Optional&lt;String&gt; への暗黙変換が発生するせいで、flatMap でも動いてしまっているんだけど、</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176314398801942" id="message-400176314398801942" title="Message sent: 09-Jan-18 06:37 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">実際には全部の要素が .some(String) になっているので、flatMapにする意味がなくって、mapにするべき、という例です。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176364298305538" id="message-400176364298305538" title="Message sent: 09-Jan-18 06:38 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">で、Swift4でStringがcollectionになっちゃったことによって・・・</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176495420768257" id="message-400176495420768257" title="Message sent: 09-Jan-18 06:38 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline language-swift">let y = cats.flatMap { $0.name } print(y)</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176528102522880" id="message-400176528102522880" title="Message sent: 09-Jan-18 06:38 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">
            <div class="pre pre--multiline nohighlight">["m", "i", "k", "e", "m", "i", "k", "e", "m", "i", "k", "e"]</div>
          </span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176580128800768" id="message-400176580128800768" title="Message sent: 09-Jan-18 06:38 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">同じ間違いを、 <span class="pre pre--inline">$0.age</span> じゃなくて、 <span class="pre pre--inline">$0.name</span> で行った場合</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176600794267659" id="message-400176600794267659" title="Message sent: 09-Jan-18 06:38 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">↑のようにもっと悲惨な事になります。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176704334594048" id="message-400176704334594048" title="Message sent: 09-Jan-18 06:39 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">今度はこれは何が起きてるかっていうと、Collectionを返す関数をflatMap しているので、正しく flatten されてしまっていて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176757694660611" id="message-400176757694660611" title="Message sent: 09-Jan-18 06:39 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">["mike", "mike", "mike"] になってほしかったのが</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400176861881040907" id="message-400176861881040907" title="Message sent: 09-Jan-18 06:39 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">"mike" が ["m", "i", "k", "e"] とみなされて、二重配列がflattenされる挙動になっちゃった。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400177035290607616" id="message-400177035290607616" title="Message sent: 09-Jan-18 06:40 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">想定してるのが「mapしたいのに間違ってflatMap書いちゃった」シナリオだから、</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400177054533943307" id="message-400177054533943307" title="Message sent: 09-Jan-18 06:40 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">挙動すらぶっ壊れたってことですね</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="400177491194413067" id="message-400177491194413067" title="Message sent: 09-Jan-18 06:42 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">で、この問題は、flatMapが受け付けるクロージャが T-&gt;[U] と T-&gt;U? の2種類のオーバーロードがあることによって、 全てがややこしくなってるから、 後者の T-&gt;U? を受け付けるflatMapはcompactMapに名前を変えることにした。</span>
        </div>
      </div>
      <div class="chatlog__reactions">
        <div class="chatlog__reaction" title="clap_tone1">
          <img class="emoji emoji--small" alt="👏🏻" src="https://twemoji.maxcdn.com/2/svg/1f44f-1f3fb.svg" loading="lazy">
          <span class="chatlog__reaction-count">2</span>
        </div>
        <div class="chatlog__reaction" title="heart_eyes">
          <img class="emoji emoji--small" alt="😍" src="https://twemoji.maxcdn.com/2/svg/1f60d.svg" loading="lazy">
          <span class="chatlog__reaction-count">2</span>
        </div>
      </div>
    </div>
  </div>
</div>