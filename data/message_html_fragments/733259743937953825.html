<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/189711109966659584/95280765d1be73ce985dce15ea3585f6.png?size=128" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="omochimetaru#1122" data-user-id="189711109966659584" style="color: rgb(237,171,161)">omochimetaru</span>
    <span class="chatlog__timestamp">16-Jul-20 09:40 AM</span>
    <div class="chatlog__message " data-message-id="733256697992314881" id="message-733256697992314881" title="Message sent: 16-Jul-20 09:40 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><span class="pre pre--inline">"\(foo)"</span> の実装がどうなるのか見た <a href="https://github.com/apple/swift/blob/87df9961a5c8ec5f6db11ae2587c13ae57ac1bd4/stdlib/public/core/StringInterpolation.swift">https://github.com/apple/swift/blob/87df9961a5c8ec5f6db11ae2587c13ae57ac1bd4/stdlib/public/core/StringInterpolation.swift</a></span>
        </div>
      </div>
      <div class="chatlog__embed">
        <div class="chatlog__embed-color-pill" style="background-color: rgba(30,35,39,255)"></div>
        <div class="chatlog__embed-content-container">
          <div class="chatlog__embed-content">
            <div class="chatlog__embed-text">
              <div class="chatlog__embed-title">
                <a class="chatlog__embed-title-link" href="https://github.com/apple/swift/blob/87df9961a5c8ec5f6db11ae2587c13ae57ac1bd4/stdlib/public/core/StringInterpolation.swift">
                  <div class="markdown preserve-whitespace">apple/swift</div>
                </a>
              </div>
              <div class="chatlog__embed-description">
                <div class="markdown preserve-whitespace">The Swift Programming Language. Contribute to apple/swift development by creating an account on GitHub.</div>
              </div>
            </div>
            <div class="chatlog__embed-thumbnail-container">
              <a class="chatlog__embed-thumbnail-link" href="https://images-ext-2.discordapp.net/external/fj7m7VLuaV_seT8bPYkMDFODFrNdHunv8fIJancJpw4/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/10639145">
                <img class="chatlog__embed-thumbnail" src="https://images-ext-2.discordapp.net/external/fj7m7VLuaV_seT8bPYkMDFODFrNdHunv8fIJancJpw4/%3Fs%3D400%26v%3D4/https/avatars2.githubusercontent.com/u/10639145" alt="Thumbnail" loading="lazy">
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="chatlog__reactions">
        <div class="chatlog__reaction" title="100">
          <img class="emoji emoji--small" alt="💯" src="https://twemoji.maxcdn.com/2/svg/1f4af.svg" loading="lazy">
          <span class="chatlog__reaction-count">1</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733257051387723808" id="message-733257051387723808" title="Message sent: 16-Jul-20 09:41 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">1. TextOutputStreamable かつ CustomStringConvertibleの場合 2. TextOutputStreamableの場合 3. CustomStringConvertibleの場合 4. 任意の<span class="pre pre--inline">&lt;T&gt;</span> 5. <span class="pre pre--inline">Any.Type</span> の場合 の5つのオーバーロードがあるっぽい</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733257165422460978" id="message-733257165422460978" title="Message sent: 16-Jul-20 09:42 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">4のケースは <span class="pre pre--inline">_print_unlocked</span> っていう謎の関数に転送されていて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733257427419660338" id="message-733257427419660338" title="Message sent: 16-Jul-20 09:43 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">Mirror.swift において定義されている <span class="pre pre--inline">String.init&lt;T&gt;(describing: T)</span> の実装も、 <span class="pre pre--inline">_print_unlocked</span> への転送だった。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733257558726279178" id="message-733257558726279178" title="Message sent: 16-Jul-20 09:43 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><span class="pre pre--inline">_print_unlocked</span> の実装は結構面白くて</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733258124508790864" id="message-733258124508790864" title="Message sent: 16-Jul-20 09:46 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">6-1 最初の分岐が魔法関数 <span class="pre pre--inline">_openExistential</span> を使ってる <div class="pre pre--multiline language-swift"> if _openExistential(type(of: value as Any), do: _isOptional) { let debugPrintable = value as! CustomDebugStringConvertible debugPrintable.debugDescription.write(to: &amp;target) return }</div></span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733258596753735751" id="message-733258596753735751" title="Message sent: 16-Jul-20 09:47 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">_isOptionalは<span class="pre pre--inline">&lt;T&gt;</span> を受けるので必ずopenできるがその先でoptionalかチェックするから、これでAnyの中に入ってるOptionalとかをおそらく必ず展開できて、 OptionalだからCustomDebugStringConvertibleが通る</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733258891625758820" id="message-733258891625758820" title="Message sent: 16-Jul-20 09:49 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">その先は 6-2: String分岐, 6-3: TextOutputStreamable分岐, 6-4: CustomSTringConvertible分岐, 6-5: CustomDebugStringConvertible分岐, で、最後のelseが 6-6: <span class="pre pre--inline">Mirror(reflecting: value)</span></span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733259254995222589" id="message-733259254995222589" title="Message sent: 16-Jul-20 09:50 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">1が定義されているのは、もし1が無かった場合、2と3のオーバーロード解決が曖昧になるからだと思う。 で、1の実装は2と同じで、 ２の実装と3の実装は6-3と6-4と同じになってる</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733259495530037269" id="message-733259495530037269" title="Message sent: 16-Jul-20 09:51 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ということは、2と3は4からの6-Xに対する最適化ショートカットで、1は2と3の都合で必要になった関数</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733259551423332425" id="message-733259551423332425" title="Message sent: 16-Jul-20 09:51 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">気になるのは6-5のショートカットが無いことだけど</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733259743937953825" id="message-733259743937953825" title="Message sent: 16-Jul-20 09:52 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">もしそれを実装してしまうと(7とする)、 2と3と7の重複組合せを順序付けするためには、 1に相当するやつの(2,7)版、(3,7)版、(2,3,7)版が必要になって</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733259800716116038" id="message-733259800716116038" title="Message sent: 16-Jul-20 09:52 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">組合せ爆発するからあきらめたんじゃなかろうか。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733260278699130890" id="message-733260278699130890" title="Message sent: 16-Jul-20 09:54 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ちなみに、<span class="pre pre--inline">foo</span> はオプショナルの場合の fix-itが2つ出るが、片方は、 <span class="pre pre--inline">String(describing: foo)</span> への書き換えだから、 <span class="pre pre--inline">String.init(describing:)</span> の実装と 4の実装が同じ( <span class="pre pre--inline">_print_unlocked</span> )なのは暗黙的な規約っぽい。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="733260650096361514" id="message-733260650096361514" title="Message sent: 16-Jul-20 09:56 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><span class="pre pre--inline">_print_unlocked</span> は第二引数でStreamを取れるけどstdlib internalなので、 これはユーザーに提供されていない事になる。 <span class="pre pre--inline">String.init(describing:)</span> を使ってエミュレートできるけど、ストリーム処理可能な場合にパフォーマンスロスが出ちゃう。</span>
        </div>
      </div>
    </div>
  </div>
</div>