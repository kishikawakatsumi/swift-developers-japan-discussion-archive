<div class="chatlog__message-group">
  <div class="chatlog__author-avatar-container">
    <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/293624673265123328/accd07acc220a18568ba46a6e9ede18a.png?size=128" alt="Avatar" loading="lazy">
  </div>
  <div class="chatlog__messages">
    <span class="chatlog__author-name" title="koher#9336" data-user-id="293624673265123328" style="color: rgb(17,128,106)">koher</span>
    <a href="/channels/307001159565180928?category=開発環境, ライブラリ&amp;channel=uikit&amp;message_id=437828818950946826"><span class="chatlog__timestamp">23-Apr-18 04:13 AM</span></a>
    <div class="chatlog__message " data-message-id="437828300790956032" id="message-437828300790956032" title="Message sent: 23-Apr-18 04:13 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">結局↓こうなりました。 <div class="pre pre--multiline language-swift">extension UIImageView { public var viewToImage: CGAffineTransform? { guard let image = self.image else { return nil } switch contentMode { case .scaleAspectFit: let viewSize = frame.size let imageSize = image.size if viewSize.width / viewSize.height &lt; imageSize.width / imageSize.height { return UIImageView.viewToImageFittingHorizontally(viewSize: viewSize, imageSize: imageSize) } else { return UIImageView.viewToImageFittingVertically(viewSize: viewSize, imageSize: imageSize) } case .scaleAspectFill: let viewSize = frame.size let imageSize = image.size if viewSize.width / viewSize.height &lt; imageSize.width / imageSize.height { return UIImageView.viewToImageFittingVertically(viewSize: viewSize, imageSize: imageSize) } else { return UIImageView.viewToImageFittingHorizontally(viewSize: viewSize, imageSize: imageSize) } default: fatalError("Unsupported `contentMode`: \(contentMode)") } } private static func viewToImageFittingHorizontally(viewSize: CGSize, imageSize: CGSize) -&gt; CGAffineTransform { let scale = imageSize.width / viewSize.width let offsetY = (imageSize.height - viewSize.height * scale) / 2 return CGAffineTransform(a: scale, b: 0, c: 0, d: scale, tx: 0, ty: offsetY) } private static func viewToImageFittingVertically(viewSize: CGSize, imageSize: CGSize) -&gt; CGAffineTransform { let scale = imageSize.height / viewSize.height let offsetX = (imageSize.width - viewSize.width * scale) / 2 return CGAffineTransform(a: scale, b: 0, c: 0, d: scale, tx: offsetX, ty: 0) } }</div></span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="437828576906313729" id="message-437828576906313729" title="Message sent: 23-Apr-18 04:14 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace">ビュー座標系から画像座標系への座標変換行列を <span class="pre pre--inline">CGAffineTransform</span> で得ます。 <span class="pre pre--inline">.scallAspectFit</span> と <span class="pre pre--inline">.scallAspectFill</span> にしか対応してませんが。</span>
        </div>
      </div>
    </div>
    <div class="chatlog__message " data-message-id="437828818950946826" id="message-437828818950946826" title="Message sent: 23-Apr-18 04:15 AM">
      <div class="chatlog__content">
        <div class="markdown">
          <span class="preserve-whitespace"><s>あ、演算子の実装が別にいるか。</s> 大丈夫だった。</span>
          <span class="chatlog__edited-timestamp" title="23-Apr-18 04:16 AM">(edited)</span>
        </div>
      </div>
    </div>
  </div>
</div>