<div class="chatlog__message-group">
  <div id="chatlog__message-container-437828300790956032" class="chatlog__message-container " data-message-id="437828300790956032">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <img class="chatlog__avatar" src="https://cdn.discordapp.com/avatars/293624673265123328/accd07acc220a18568ba46a6e9ede18a.png?size=512" alt="Avatar" loading="lazy">
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__header">
          <span class="chatlog__author" style="color: rgb(17, 128, 106)" title="koher#9336" data-user-id="293624673265123328">koher</span>
          <a href="/channels/307001159565180928?category=開発環境, ライブラリ&amp;channel=uikit&amp;message_id=437828818950946826"><span class="chatlog__timestamp">23-Apr-18 04:13 AM</span></a>
        </div>
        <div class="chatlog__content chatlog__markdown">
          <span class="chatlog__markdown-preserve">結局↓こうなりました。 <div class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">extension UIImageView { public var viewToImage: CGAffineTransform? { guard let image = self.image else { return nil } switch contentMode { case .scaleAspectFit: let viewSize = frame.size let imageSize = image.size if viewSize.width / viewSize.height &lt; imageSize.width / imageSize.height { return UIImageView.viewToImageFittingHorizontally(viewSize: viewSize, imageSize: imageSize) } else { return UIImageView.viewToImageFittingVertically(viewSize: viewSize, imageSize: imageSize) } case .scaleAspectFill: let viewSize = frame.size let imageSize = image.size if viewSize.width / viewSize.height &lt; imageSize.width / imageSize.height { return UIImageView.viewToImageFittingVertically(viewSize: viewSize, imageSize: imageSize) } else { return UIImageView.viewToImageFittingHorizontally(viewSize: viewSize, imageSize: imageSize) } default: fatalError("Unsupported `contentMode`: \(contentMode)") } } private static func viewToImageFittingHorizontally(viewSize: CGSize, imageSize: CGSize) -&gt; CGAffineTransform { let scale = imageSize.width / viewSize.width let offsetY = (imageSize.height - viewSize.height * scale) / 2 return CGAffineTransform(a: scale, b: 0, c: 0, d: scale, tx: 0, ty: offsetY) } private static func viewToImageFittingVertically(viewSize: CGSize, imageSize: CGSize) -&gt; CGAffineTransform { let scale = imageSize.height / viewSize.height let offsetX = (imageSize.width - viewSize.width * scale) / 2 return CGAffineTransform(a: scale, b: 0, c: 0, d: scale, tx: offsetX, ty: 0) } }</div></span>
        </div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-437828576906313729" class="chatlog__message-container " data-message-id="437828576906313729">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="23-Apr-18 04:14 AM">04:14</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown">
          <span class="chatlog__markdown-preserve">ビュー座標系から画像座標系への座標変換行列を <span class="chatlog__markdown-pre chatlog__markdown-pre--inline">CGAffineTransform</span> で得ます。 <span class="chatlog__markdown-pre chatlog__markdown-pre--inline">.scallAspectFit</span> と <span class="chatlog__markdown-pre chatlog__markdown-pre--inline">.scallAspectFill</span> にしか対応してませんが。</span>
        </div>
      </div>
    </div>
  </div>
  <div id="chatlog__message-container-437828818950946826" class="chatlog__message-container " data-message-id="437828818950946826">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__short-timestamp" title="23-Apr-18 04:15 AM">04:15</div>
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__content chatlog__markdown">
          <span class="chatlog__markdown-preserve"><s>あ、演算子の実装が別にいるか。</s> 大丈夫だった。</span>
          <span class="chatlog__edited-timestamp" title="23-Apr-18 04:16 AM">(edited)</span>
        </div>
      </div>
    </div>
  </div>
</div>