<div class="chatlog__message-group">
  <div id="chatlog__message-container-990159991212220426" class="chatlog__message-container" data-message-id="990159991212220426">
    <div class="chatlog__message">
      <div class="chatlog__message-aside">
        <div class="chatlog__reply-symbol"></div><img class="chatlog__avatar" src="https://cdn.discordapp.com/avatars/506800600672108554/f342ba45362a4db2d7b0d2b66c02e365.png?size=512" alt="Avatar" loading="lazy">
      </div>
      <div class="chatlog__message-primary">
        <div class="chatlog__reply"><img class="chatlog__reply-avatar" src="https://cdn.discordapp.com/avatars/293624673265123328/accd07acc220a18568ba46a6e9ede18a.png?size=512" alt="Avatar" loading="lazy">
          <div class="chatlog__reply-author" style="color:rgb(17,128,106)" title="koher">koher</div>
          <div class="chatlog__reply-content"><span class="chatlog__reply-link" onclick="scrollToMessage(event,'989675822648524820')"> 僕は次の二つの方法のいずれかを用いています（スナップショットテストはしていませんが、 Xcode Preview のためにやっています）。 ① 一つは、 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">@StateObject</code> を保持する <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">View</code> とレイアウトする <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">View</code> を分離し、前者が後者を利用する形にすることです。 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">// state 保持用の View とレイアウト用の View を分離する例 struct FooStateView: View { @StateObject private var state: FooViewState&lt;FooService&gt; ... var body: some View { FooView(bar: state.bar, baz: $state.baz) } } struct FooView: View { let bar: Int @Binding var baz: String ... }</code> こうしておけば <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">state</code> とは独立に <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">FooView</code> の任意の状態を簡単に実現できるので、スナップショットテストやプレビューのためのモックが必要なくなります。↑は SwiftUI の例ですが、UIKit の場合でも、外から渡された状態を再現するだけの VC と、 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">state</code> を保持して状態を伝えるだけの VC とに分離することで、同様のことが実現可能です。 ② もう一つは、公開する <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">state</code> のプロパティをすべて <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">@Publsihed public var</code> にしてしまうことです。そうすれば、スナップショットテストやプレビューの際に、任意の状態の <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">state</code> を簡単に作れます。 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">UserService</code> 等にはダミーのテスト用実装を渡して何の仕事もさせないようにします。なお、 computed property の場合は setter を作れないので、↓のように republish する必要が生じます。 <code class="chatlog__markdown-pre chatlog__markdown-pre--multiline language-swift">// computed property の代わりに republish が必要になる例 // Before @MainActor public final class FooViewState&lt;FooService: FooServiceProtocol&gt;: ObserbalbleObject { @Published public var baz: String = "" public var isQux: Bool { baz.isEmpty } ... } // After @MainActor public final class FooViewState&lt;FooService: FooServiceProtocol&gt;: ObserbalbleObject { @Published public var baz: String = "" @Published public var isQux: Bool = false ... init(...) { ... $baz.map(\.isEmpty).assign(to: &amp;$isQux) // republish } ... } </code> ①②とも一長一短で、①は実装が冗長になりがちです。②は外から触っていいものといけないもの（本来 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">private(set)</code> であるべきもの）の区別が付きづらいです。テスト以外のケースで、本来メソッドを通して状態を変更しなければならないプロパティを setter で変更してしまうと、 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">state</code> の状態を壊してしまう可能性があります。 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">@testable import</code> を前提に、 <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">internal(set)</code> にするのも良いかもしれません。 </span></div>
        </div>
        <div class="chatlog__header"><span class="chatlog__author" title="shibastripe#8957" data-user-id="506800600672108554">shibastripe</span> <a href="/channels/499393715140558881?category=コミュニティ&amp;channel=swift-zoomin&amp;message_id=990159991212220426"><span class="chatlog__timestamp"></span></a><a href="#chatlog__message-container-990159991212220426">06/25/2022 7:42 AM</a></div>
        <div class="chatlog__content chatlog__markdown"><span class="chatlog__markdown-preserve">なるほどありがとうございます！！特に <code class="chatlog__markdown-pre chatlog__markdown-pre--inline">internal(set)</code> で対処するのが自分のユースケースにピッタリ合っていて非常に勉強になります <img loading="lazy" class="chatlog__emoji " alt="🙇" title="person_bowing" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f647.svg">‍♂️</span></div>
        <div class="chatlog__reactions">
          <div class="chatlog__reaction" title="slight_smile"><img class="chatlog__emoji chatlog__emoji--small" alt="🙂" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f642.svg" loading="lazy"> <span class="chatlog__reaction-count">1</span></div>
        </div>
      </div>
    </div>
  </div>
</div>